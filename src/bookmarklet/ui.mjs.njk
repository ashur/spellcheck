/* {% from "system/loader.njk" import partial %} */

let handleKeydown = (event) =>
{
	if( event.key === "Escape" )
	{
		hideModal();
	}
};

let hideModal = () =>
{
	document.querySelector( ".sb-modal-system" ).classList.remove( "sb-modal-open", "spellcheck" );
	document.querySelector( ".sb-modal-wrapper" ).innerHTML = "";

	document.removeEventListener( "keydown", handleKeydown );
};

const UI = {
	addStyles: () =>
	{
		/* eslint-disable quotes */
		const styles = `{{- partial('spellcheck.css', false) | cssmin -}}`;
		/* eslint-enable quotes */

		const styleElement = document.createElement( "style" );
		styleElement.innerText = styles;
		document.head.appendChild( styleElement );

		console.log( "ðŸŽ¨ Spell Check: Stylesheet loaded" );
	},

	hideModal: () => {
		hideModal();
	},

	/* {# */
	/* eslint-disable no-unused-vars */
	/* #} */

	/**
	 * @param {string} title
	 * @param {string} subtitle
	 * @param {string} body
	 * @param {Object} flags
	 */
	showModal: ({title, subtitle, body, flags={}} = {}) =>
	{
		if( !document.querySelector( "#js-hook-pz-moment__game.on-stage" ) )
		{
			console.log( "ðŸ™ˆ Spell Check: Puzzle is not currently visible" );
			return;
		}

		/* eslint-disable quotes */
		const modalHeading = `{{- partial('modal/heading.njk') -}}`;

		let modalSubheading;
		if( subtitle )
		{
			modalSubheading = `{{- partial('modal/subheading.njk') -}}`;
		}

		let message;
		if( flags.REMINDER === "true" )
		{
			message = `{{- partial('messages/reminder.njk') -}}`;
		}
		if( flags.GRID_RESET === "true" )
		{
			message = `{{- partial('messages/reset.njk') -}}`;
		}

		let modalWrapper = `{{- partial('modal/wrapper.njk') -}}`;
		/* eslint-enable quotes */

		document.querySelector( ".sb-modal-system" ).classList.add( "sb-modal-open", "spellcheck" );
		document.querySelector( ".sb-modal-wrapper" ).innerHTML = modalWrapper;
		document.querySelector( ".sb-modal-close" ).addEventListener( "click", hideModal );

		document.addEventListener( "keydown", handleKeydown );

		/* eslint-disable quotes */
		/* {%- if env.SPELLCHECK_TIMER %} */
		console.timeEnd(`{{ env.SPELLCHECK_TIMER }}`);
		/* {%- endif %} */
		/* eslint-enable quotes */
	},

	/* {# */
	/* eslint-enable no-unused-vars */
	/* #} */
};

export default UI;
